{% extends 'base.html' %}
{% block title %}All Foods - Fridge Buddy{% endblock %}
{% load static %}

{% block head %}
  <link rel="icon" type="image/x-icon" href="{% static 'images/fridgebuddy.ico' %}" />
  <link rel="stylesheet" href="{% static 'css/food_catalog.css' %}" />
  <link rel="stylesheet" href="{% static 'css/food_catalog_enhanced.css' %}" />
{% endblock %}

{% block content %}
  {% csrf_token %}
  <h1>Food Catalog</h1>
  
  <!-- Display Messages -->
  {% if messages %}
      {% for message in messages %}
          <div class="alert alert-{{ message.tags }}">
              {{ message }}
          </div>
      {% endfor %}
  {% endif %}
  
  <div class="catalog-layout">
    <div class="food-catalog">
      {% if foods %}
        {% regroup foods by category as category_list %}
        <ul class="category-list">
          {% for category in category_list %}
            <li class="category-item">
              <h2 class="category-header" data-category="{{ category.grouper }}" data-expanded="false">
                <span class="category-arrow">‚ñ∂</span>
                <span>{{ category.grouper|title }} ({{ category.list|length }})</span>
              </h2>
              <ul id="category-{{ category.grouper }}" class="food-list" style="display: none;">
                {% for food in category.list %}
                  <li class="food-item">
                    <input type="checkbox" class="food-checkbox" data-food-id="{{ food.pk }}" data-food-name="{{ food.name }}" data-food-category="{{ food.category }}">
                    
                    <div class="food-item-content">
                      <div class="food-item-info">
                        <h3>{{ food.name }}</h3>
                        {% if food.description %}
                          <p class="food-item-description">{{ food.description }}</p>
                        {% endif %}
                      </div>
                      
                      {% if user.is_authenticated %}
                        <div class="food-item-actions">
                          <select class="container-select" data-food-id="{{ food.pk }}">
                            <option value="">Select List</option>
                            {% for container in user.containers.all %}
                              <option value="{{ container.pk }}">
                                {% if container.container_type == 'SHOPPING' %}
                                  üõí {{ container.name }}
                                {% elif container.container_type == 'FRIDGE' %}
                                  üßä {{ container.name }}
                                {% elif container.container_type == 'PANTRY' %}
                                  ü•´ {{ container.name }}
                                {% elif container.container_type == 'FREEZER' %}
                                  ‚ùÑÔ∏è {{ container.name }}
                                {% else %}
                                  üì¶ {{ container.name }}
                                {% endif %}
                              </option>
                            {% endfor %}
                          </select>
                          <button class="add-to-container-btn" data-food-id="{{ food.pk }}">Add to List</button>
                        </div>
                      {% endif %}
                    </div>
                  </li>
                {% endfor %}
              </ul>
            </li>
          {% endfor %}
        </ul>
        
        {% if user.is_authenticated %}
          <div class="batch-actions">
            <button id="batch-add-btn" class="btn btn-primary">üõí Add Selected to Shopping List</button>
            <span id="selected-count">0 items selected</span>
          </div>
        {% endif %}
      {% else %}
        <p>No foods available in the catalog yet.</p>
      {% endif %}

      <div class="add-food-section">
        <h2>Don't see something you like? Add it here:</h2>
        <a href="{% url 'food-create' %}" class="btn btn-primary">Add New Food</a>
      </div>
    </div>

    <!-- Shopping List Sidebar -->
    {% if user.is_authenticated %}
      <div class="shopping-sidebar">
        <h2>
          <a href="{% url 'shopping-list' %}">
            üõí My Shopping List
          </a>
        </h2>
        <div id="shopping-list-content">
          {% if shopping_items %}
            {% for item in shopping_items %}
              <div class="shopping-item" data-item-id="{{ item.pk }}">
                <div class="shopping-item-info">
                  <div class="shopping-item-name">{{ item.catalog_food.name }}</div>
                  <div class="shopping-item-category">{{ item.catalog_food.category }}</div>
                </div>
                <div class="shopping-item-quantity">{{ item.quantity }}</div>
              </div>
            {% endfor %}
          {% else %}
            <div class="shopping-list-empty" id="empty-message">
              Your shopping list is empty. Select items from the catalog to add them!
            </div>
          {% endif %}
        </div>
      </div>
    {% endif %}
  </div>

  <script src="{% static 'js/food_catalog.js' %}"></script>
  <script>
    // Template-specific configuration
    const batchAddToShoppingUrl = '{% url "batch-add-to-shopping" %}';
    const addFoodToContainerUrl = '{% url "add-food-to-container" %}';
  </script>
{% endblock %}
